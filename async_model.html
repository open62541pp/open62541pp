<!-- https://github.com/doxygen/doxygen/blob/master/templates/html/header.html -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>open62541pp: Asynchronous model</title>
<link rel="icon" type="image/png" sizes="16x16" href="https://open62541pp.github.io//favicon-16x16.png" />
<link rel="icon" type="image/png" sizes="32x32" href="https://open62541pp.github.io//favicon-32x32.png" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
<script defer src="https://cloud.umami.is/script.js" data-website-id="e95fb465-e14d-4239-be4d-bad5246adc7a"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">open62541pp<span id="projectnumber">&#160;0.16.0</span>
   </div>
   <div id="projectbrief">C++ wrapper of open62541</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="guide.html">Development guide</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Asynchronous model</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md54">Completion tokens</a><ul><li class="level2"><a href="#autotoc_md55">Callback function</a></li>
<li class="level2"><a href="#autotoc_md56">Future completion token</a></li>
<li class="level2"><a href="#autotoc_md57">Deferred completion token</a></li>
<li class="level2"><a href="#autotoc_md58">Detached completion token</a></li>
<li class="level2"><a href="#autotoc_md59">Custom completion token</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md__2home_2runner_2work_2open62541pp_2open62541pp_2doc_2guide_2async__model"></a></p>
<p>Open62541pp adapts the well-proven <a href="https://think-async.com/asio/asio-1.28.0/doc/asio/overview/model.html" target="_blank">asynchronous model of (Boost) Asio</a>. A key goal of Asio's asynchronous model is to support multiple composition mechanisms. This is achieved via completion tokens.</p>
<h1><a class="anchor" id="autotoc_md54"></a>
Completion tokens</h1>
<p>Open62541pp accepts completion tokens as the final argument of asynchronous operations.</p>
<div class="fragment"><div class="line"><span class="comment">// Function signature of the completion handler: void(opcua::ReadResponse&amp;)</span></div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> CompletionToken&gt;</div>
<div class="line"><span class="keyword">auto</span> <a class="code hl_function" href="group__Read.html#ga538a98e90445b1e39dc099edda570752">opcua::services::readAsync</a>(</div>
<div class="line">    <a class="code hl_class" href="classopcua_1_1Client.html">opcua::Client</a>&amp; connection,</div>
<div class="line">    <span class="keyword">const</span> <a class="code hl_class" href="classopcua_1_1ReadRequest.html">opcua::ReadRequest</a>&amp; request,</div>
<div class="line">    CompletionToken&amp;&amp; token</div>
<div class="line">);</div>
<div class="ttc" id="aclassopcua_1_1Client_html"><div class="ttname"><a href="classopcua_1_1Client.html">opcua::Client</a></div><div class="ttdoc">High-level client class.</div><div class="ttdef"><b>Definition</b> <a href="client_8hpp_source.html#l00121">client.hpp:121</a></div></div>
<div class="ttc" id="aclassopcua_1_1ReadRequest_html"><div class="ttname"><a href="classopcua_1_1ReadRequest.html">opcua::ReadRequest</a></div><div class="ttdoc">UA_ReadRequest wrapper class.</div><div class="ttdef"><b>Definition</b> <a href="types__composed_8hpp_source.html#l01330">types_composed.hpp:1330</a></div></div>
<div class="ttc" id="agroup__Read_html_ga538a98e90445b1e39dc099edda570752"><div class="ttname"><a href="group__Read.html#ga538a98e90445b1e39dc099edda570752">opcua::services::readAsync</a></div><div class="ttdeci">auto readAsync(Client &amp;connection, const ReadRequest &amp;request, CompletionToken &amp;&amp;token)</div><div class="ttdoc">Read one or more attributes of one or more nodes (client only).</div><div class="ttdef"><b>Definition</b> <a href="attribute_8hpp_source.html#l00061">attribute.hpp:61</a></div></div>
</div><!-- fragment --><p>Following completion tokens can be used (and described in more detail below):</p>
<ul>
<li>A callback function (object) with the expected completion signature</li>
<li><code><a class="el" href="group__Async.html#gae789f136da0b3d4d725f1ba59ca0614c" title="Future completion token object.">opcua::useFuture</a></code> to return a future object <code>std::future&lt;T&gt;</code></li>
<li><code><a class="el" href="group__Async.html#ga85a5c61e4024d350f333d7763bbdff36" title="Deferred completion token object.">opcua::useDeferred</a></code> to return a callable for deferred execution</li>
<li><code><a class="el" href="group__Async.html#ga84807736f5bcb08a19160455f71a8863" title="Detached completion token object.">opcua::useDetached</a></code> to detach the asynchronous operation</li>
<li>Custom tokens by providing template specializations for <code><a class="el" href="structopcua_1_1AsyncResult.html">opcua::AsyncResult</a></code></li>
</ul>
<h2><a class="anchor" id="autotoc_md55"></a>
Callback function</h2>
<p>If the user passes a function object as the completion token, the asynchronous operation behaves as previously described: the operation begins, and when the operation completes the result is passed to the callback. The callback function must match the expected signature:</p>
<div class="fragment"><div class="line">void(T);   <span class="comment">// for trivially copyable types</span></div>
<div class="line">void(T&amp;);  <span class="comment">// for non-trivially copyable types</span></div>
</div><!-- fragment --><div class="fragment"><div class="line"><a class="code hl_function" href="group__Read.html#ga538a98e90445b1e39dc099edda570752">opcua::services::readAsync</a>(</div>
<div class="line">    client,</div>
<div class="line">    request,</div>
<div class="line">    [](<a class="code hl_class" href="classopcua_1_1ReadResponse.html">opcua::ReadResponse</a>&amp; response) {</div>
<div class="line">        <span class="comment">// ...</span></div>
<div class="line">    }</div>
<div class="line">);</div>
<div class="ttc" id="aclassopcua_1_1ReadResponse_html"><div class="ttname"><a href="classopcua_1_1ReadResponse.html">opcua::ReadResponse</a></div><div class="ttdoc">UA_ReadResponse wrapper class.</div><div class="ttdef"><b>Definition</b> <a href="types__composed_8hpp_source.html#l01357">types_composed.hpp:1357</a></div></div>
</div><!-- fragment --><p>The callback is executed within the client's or server's event loop. Please make sure not to block the event loop. Waiting for asynchronous results within the callback will block the further execution of the event loop.</p>
<h2><a class="anchor" id="autotoc_md56"></a>
Future completion token</h2>
<p>The special token <code><a class="el" href="group__Async.html#gae789f136da0b3d4d725f1ba59ca0614c" title="Future completion token object.">opcua::useFuture</a></code> can be passed as completion token to return a future object <code>std::future&lt;T&gt;</code>.</p>
<div class="fragment"><div class="line">std::future&lt;opcua::ReadResponse&gt; future = <a class="code hl_function" href="group__Read.html#ga538a98e90445b1e39dc099edda570752">opcua::services::readAsync</a>(client, request, <a class="code hl_variable" href="group__Async.html#gae789f136da0b3d4d725f1ba59ca0614c">opcua::useFuture</a>);</div>
<div class="line"><span class="keyword">auto</span> response = future.get();</div>
<div class="ttc" id="agroup__Async_html_gae789f136da0b3d4d725f1ba59ca0614c"><div class="ttname"><a href="group__Async.html#gae789f136da0b3d4d725f1ba59ca0614c">opcua::useFuture</a></div><div class="ttdeci">constexpr UseFutureToken useFuture</div><div class="ttdoc">Future completion token object.</div><div class="ttdef"><b>Definition</b> <a href="async_8hpp_source.html#l00060">async.hpp:60</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md57"></a>
Deferred completion token</h2>
<p>The token <code><a class="el" href="group__Async.html#ga85a5c61e4024d350f333d7763bbdff36" title="Deferred completion token object.">opcua::useDeferred</a></code> is used to indicate that an asynchronous operation should return a function object to lazily launch the operation.</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> func = <a class="code hl_function" href="group__Read.html#ga538a98e90445b1e39dc099edda570752">opcua::services::readAsync</a>(client, request, <a class="code hl_variable" href="group__Async.html#ga85a5c61e4024d350f333d7763bbdff36">opcua::useDeferred</a>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// start operation with provided completion token</span></div>
<div class="line">func([](<span class="keyword">auto</span>&amp;&amp; response) { <span class="comment">/* ... */</span> });</div>
<div class="line"><span class="keyword">auto</span> future = func(useFuture);</div>
<div class="line"><span class="comment">// ...</span></div>
<div class="ttc" id="agroup__Async_html_ga85a5c61e4024d350f333d7763bbdff36"><div class="ttname"><a href="group__Async.html#ga85a5c61e4024d350f333d7763bbdff36">opcua::useDeferred</a></div><div class="ttdeci">constexpr UseDeferredToken useDeferred</div><div class="ttdoc">Deferred completion token object.</div><div class="ttdef"><b>Definition</b> <a href="async_8hpp_source.html#l00090">async.hpp:90</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md58"></a>
Detached completion token</h2>
<p>The token <code><a class="el" href="group__Async.html#ga84807736f5bcb08a19160455f71a8863" title="Detached completion token object.">opcua::useDetached</a></code> is used to indicate that an asynchronous operation is detached. That is, there is no completion handler waiting for the operation's result.</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="group__Read.html#ga538a98e90445b1e39dc099edda570752">opcua::services::readAsync</a>(client, request, <a class="code hl_variable" href="group__Async.html#ga84807736f5bcb08a19160455f71a8863">opcua::useDetached</a>);</div>
<div class="line"><span class="comment">// no way to check if the operation succeeded...</span></div>
<div class="ttc" id="agroup__Async_html_ga84807736f5bcb08a19160455f71a8863"><div class="ttname"><a href="group__Async.html#ga84807736f5bcb08a19160455f71a8863">opcua::useDetached</a></div><div class="ttdeci">constexpr UseDetachedToken useDetached</div><div class="ttdoc">Detached completion token object.</div><div class="ttdef"><b>Definition</b> <a href="async_8hpp_source.html#l00125">async.hpp:125</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md59"></a>
Custom completion token</h2>
<p>The <code><a class="el" href="structopcua_1_1AsyncResult.html">opcua::AsyncResult</a></code> trait is a customization point to define user-defined completion tokens via template specialization:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>PrintResultToken {};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span><a class="code hl_namespace" href="namespaceopcua.html">opcua</a> {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><span class="keyword">struct </span>AsyncResult&lt;PrintResultToken, T&gt; {</div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Initiation, <span class="keyword">typename</span> CompletionHandler, <span class="keyword">typename</span>... Args&gt;</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="structopcua_1_1AsyncResult.html#aa6dc04bbf4940717e92e71ec58f346ec">initiate</a>(Initiation&amp;&amp; initiation, PrintResultToken, Args&amp;&amp;... args) {</div>
<div class="line">        std::invoke(</div>
<div class="line">            std::forward&lt;Initiation&gt;(initiation),</div>
<div class="line">            [](T&amp; result) {</div>
<div class="line">                std::cout &lt;&lt; <span class="stringliteral">&quot;Async operation completed with result &quot;</span> &lt;&lt; result &lt;&lt; std::endl;</div>
<div class="line">            },</div>
<div class="line">            std::forward&lt;Args&gt;(args)...</div>
<div class="line">        );</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="ttc" id="anamespaceopcua_html"><div class="ttname"><a href="namespaceopcua.html">opcua</a></div><div class="ttdef"><b>Definition</b> <a href="async_8hpp_source.html#l00011">async.hpp:11</a></div></div>
<div class="ttc" id="astructopcua_1_1AsyncResult_html_aa6dc04bbf4940717e92e71ec58f346ec"><div class="ttname"><a href="structopcua_1_1AsyncResult.html#aa6dc04bbf4940717e92e71ec58f346ec">opcua::AsyncResult::initiate</a></div><div class="ttdeci">static void initiate(Initiation &amp;&amp;initiation, CompletionHandler &amp;&amp;handler, Args &amp;&amp;... args)</div><div class="ttdef"><b>Definition</b> <a href="async_8hpp_source.html#l00029">async.hpp:29</a></div></div>
</div><!-- fragment --><p>The trait's <code><a class="el" href="structopcua_1_1AsyncResult.html#aa6dc04bbf4940717e92e71ec58f346ec">opcua::AsyncResult::initiate</a></code> member function is called with three arguments:</p><ol type="1">
<li>A function object that launches the async operation (initiating function)</li>
<li>A concrete completion handler with the signature <code>void(T)</code> or <code>void(T&amp;)</code></li>
<li>Any additional arguments for the function object</li>
</ol>
<p>Please have a look at implementations in <a class="el" href="async_8hpp.html">async.hpp</a> for further details. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
