<!-- https://github.com/doxygen/doxygen/blob/master/templates/html/header.html -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>open62541pp: Error handling</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<script defer src="https://cloud.umami.is/script.js" data-website-id="e95fb465-e14d-4239-be4d-bad5246adc7a"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">open62541pp<span id="projectnumber">&#160;0.15.0</span>
   </div>
   <div id="projectbrief">C++ wrapper of open62541</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="overview.html">Overview</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Error handling</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md19">Exceptions</a></li>
<li class="level1"><a href="#autotoc_md20">Result type</a></li>
<li class="level1"><a href="#autotoc_md21">Error propagation is user callbacks</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md__2home_2runner_2work_2open62541pp_2open62541pp_2doc_2error__handling"></a></p>
<p>In OPC UA, <a href="https://reference.opcfoundation.org/Core/Part4/v105/docs/7.39" target="_blank">status codes</a> are used to indicate the result of an operation or request. They are returned as part of service responses and node values to describe the outcome, including success, failure, or error conditions. The underlying open62541 C-library adopts this model, returning a status code (<a class="elRef" target="_blank" href="open62541/types_8h.html#a8beaefc7873465d6baa54a21634b6ea7">UA_StatusCode</a>) from any function that may encounter an error. In open62541pp, the <a class="elRef" target="_blank" href="open62541/types_8h.html#a8beaefc7873465d6baa54a21634b6ea7">UA_StatusCode</a> is wrapped as <a class="el" href="classopcua_1_1StatusCode.html" title="UA_StatusCode wrapper class.">opcua::StatusCode</a> and enhanced with utility functions for easier use.</p>
<h1><a class="anchor" id="autotoc_md19"></a>
Exceptions</h1>
<p>Exceptions are the main used mechanism to report bad status codes in function calls.</p>
<p>The bases exception type <a class="el" href="classopcua_1_1BadStatus.html" title="Exception for bad status codes from open62541 UA_STATUSCODE_*.">opcua::BadStatus</a> wraps a bad status code. The underlying status code can be accessed with <a class="el" href="classopcua_1_1BadStatus.html#aa157f985a878295568af33aa718cf520">opcua::BadStatus::code()</a>. <a class="el" href="classopcua_1_1BadStatus.html#ae28cf76cb44982688d768f4f64b630b6">opcua::BadStatus::what()</a> provides a human-readable name for the status code.</p>
<p><b>Example:</b></p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <a class="code hl_class" href="classopcua_1_1NodeId.html">opcua::NodeId</a> id(<a class="code hl_enumvalue" href="group__NodeIds.html#ggab93e889b7152d5a78a993070276d1a70a0d8ba6d48210c58515c100ffcdc9b1b2">opcua::VariableId::Server_ServerStatus_CurrentTime</a>);</div>
<div class="line"><a class="code hl_class" href="classopcua_1_1Node.html">opcua::Node</a> node(client, <span class="keywordtype">id</span>);</div>
<div class="line"><span class="keywordflow">try</span> {</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> var = node.readValue();  <span class="comment">// may throw opcua::BadStatus</span></div>
<div class="line">} <span class="keywordflow">catch</span> (<span class="keyword">const</span> <a class="code hl_class" href="classopcua_1_1BadStatus.html">opcua::BadStatus</a>&amp; e) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Bad status: &quot;</span> &lt;&lt; e.<a class="code hl_function" href="classopcua_1_1BadStatus.html#aa157f985a878295568af33aa718cf520">code</a>() &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; e.<a class="code hl_function" href="classopcua_1_1BadStatus.html#ae28cf76cb44982688d768f4f64b630b6">what</a>() &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="ttc" id="aclassopcua_1_1BadStatus_html"><div class="ttname"><a href="classopcua_1_1BadStatus.html">opcua::BadStatus</a></div><div class="ttdoc">Exception for bad status codes from open62541 UA_STATUSCODE_*.</div><div class="ttdef"><b>Definition</b> <a href="exception_8hpp_source.html#l00015">exception.hpp:15</a></div></div>
<div class="ttc" id="aclassopcua_1_1BadStatus_html_aa157f985a878295568af33aa718cf520"><div class="ttname"><a href="classopcua_1_1BadStatus.html#aa157f985a878295568af33aa718cf520">opcua::BadStatus::code</a></div><div class="ttdeci">UA_StatusCode code() const noexcept</div><div class="ttdef"><b>Definition</b> <a href="exception_8hpp_source.html#l00020">exception.hpp:20</a></div></div>
<div class="ttc" id="aclassopcua_1_1BadStatus_html_ae28cf76cb44982688d768f4f64b630b6"><div class="ttname"><a href="classopcua_1_1BadStatus.html#ae28cf76cb44982688d768f4f64b630b6">opcua::BadStatus::what</a></div><div class="ttdeci">const char * what() const noexcept override</div><div class="ttdef"><b>Definition</b> <a href="exception_8hpp_source.html#l00024">exception.hpp:24</a></div></div>
<div class="ttc" id="aclassopcua_1_1NodeId_html"><div class="ttname"><a href="classopcua_1_1NodeId.html">opcua::NodeId</a></div><div class="ttdoc">UA_NodeId wrapper class.</div><div class="ttdef"><b>Definition</b> <a href="types_8hpp_source.html#l00590">types.hpp:590</a></div></div>
<div class="ttc" id="aclassopcua_1_1Node_html"><div class="ttname"><a href="classopcua_1_1Node.html">opcua::Node</a></div><div class="ttdoc">High-level node class to access node attribute, browse and populate address space.</div><div class="ttdef"><b>Definition</b> <a href="server_8hpp_source.html#l00027">server.hpp:27</a></div></div>
<div class="ttc" id="agroup__NodeIds_html_ggab93e889b7152d5a78a993070276d1a70a0d8ba6d48210c58515c100ffcdc9b1b2"><div class="ttname"><a href="group__NodeIds.html#ggab93e889b7152d5a78a993070276d1a70a0d8ba6d48210c58515c100ffcdc9b1b2">opcua::VariableId::Server_ServerStatus_CurrentTime</a></div><div class="ttdeci">@ Server_ServerStatus_CurrentTime</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md20"></a>
Result type</h1>
<p>The <a class="el" href="classopcua_1_1Result.html">opcua::Result&lt;T&gt;</a> type wraps both the result of a function and the corresponding status code. Its design is similar to <a href="https://en.cppreference.com/w/cpp/utility/optional" target="_blank"><code>std::optional</code></a> or <a href="https://en.cppreference.com/w/cpp/utility/expected" target="_blank"><code>std::expected</code></a>, making it suitable for scenarios that involve error handling without exceptions. The key difference from <code>std::expected</code> is that the status code is always present, while the result is only available if the status code indicates success. This approach avoids the performance overhead of exceptions and enhances clarity in function signatures. It also supports finer control over error management, especially in <a class="el" href="async_model.html">asynchronous contexts</a>.</p>
<p><b>Key functions:</b></p>
<ul>
<li><a class="el" href="classopcua_1_1Result.html#ad8906b4a4e26406476f3f5f38816a62b" title="Get the value of the Result.">opcua::Result&lt;T&gt;::value</a> returns the value or throws an <a class="el" href="classopcua_1_1BadStatus.html" title="Exception for bad status codes from open62541 UA_STATUSCODE_*.">opcua::BadStatus</a> exception if the status code is bad</li>
<li><a class="el" href="classopcua_1_1Result.html#a44ab2194ce7b95f6d54396829619d423" title="Get the value of the Result or a default value.">opcua::Result&lt;T&gt;::valueOr</a> returns the value or the provided default value if the status code is bad</li>
<li><a class="el" href="classopcua_1_1Result.html#af8c52372741a4af137d3600d9e9e77e0" title="Get the StatusCode of the Result.">opcua::Result&lt;T&gt;::code</a> returns the status code directly</li>
</ul>
<p>The result type is consistently used for all functions in the <a class="el" href="namespaceopcua_1_1services.html" title="OPC UA services as free functions.">opcua::services</a> namespace. For codebases that do not use exceptions, these functions can provide an alternative error-handling strategy.</p>
<p><b>Example:</b></p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <a class="code hl_class" href="classopcua_1_1NodeId.html">opcua::NodeId</a> id(<a class="code hl_enumvalue" href="group__NodeIds.html#ggab93e889b7152d5a78a993070276d1a70a0d8ba6d48210c58515c100ffcdc9b1b2">opcua::VariableId::Server_ServerStatus_CurrentTime</a>);</div>
<div class="line"><a class="code hl_class" href="classopcua_1_1Result.html">opcua::Result&lt;opcua::Variant&gt;</a> result = <a class="code hl_function" href="group__Read.html#gaaf1c6945f6ca882fdafa7d3be783f68c">opcua::services::readValue</a>(client, <span class="keywordtype">id</span>);</div>
<div class="line"><span class="keywordflow">if</span> (result.<a class="code hl_function" href="classopcua_1_1Result.html#af8c52372741a4af137d3600d9e9e77e0">code</a>().<a class="code hl_function" href="classopcua_1_1StatusCode.html#a800dd598a93c04af80b96d312c6700e9">isBad</a>()) {</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Bad status: &quot;</span> &lt;&lt; result.<a class="code hl_function" href="classopcua_1_1Result.html#af8c52372741a4af137d3600d9e9e77e0">code</a>().<a class="code hl_function" href="classopcua_1_1StatusCode.html#ace5935f872494fe518def45b1105f312">get</a>() &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; result.<a class="code hl_function" href="classopcua_1_1Result.html#af8c52372741a4af137d3600d9e9e77e0">code</a>().<a class="code hl_function" href="classopcua_1_1StatusCode.html#aa8edfc4253bc97d93129d7b123ab468f">name</a>() &lt;&lt; std::endl;</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="keyword">const</span> <a class="code hl_class" href="classopcua_1_1Variant.html">opcua::Variant</a> value = result.<a class="code hl_function" href="classopcua_1_1Result.html#ad8906b4a4e26406476f3f5f38816a62b">value</a>();</div>
<div class="line">}</div>
<div class="ttc" id="aclassopcua_1_1Result_html"><div class="ttname"><a href="classopcua_1_1Result.html">opcua::Result</a></div><div class="ttdoc">The template class Result encapsulates a StatusCode and optionally a value.</div><div class="ttdef"><b>Definition</b> <a href="result_8hpp_source.html#l00053">result.hpp:53</a></div></div>
<div class="ttc" id="aclassopcua_1_1Result_html_ad8906b4a4e26406476f3f5f38816a62b"><div class="ttname"><a href="classopcua_1_1Result.html#ad8906b4a4e26406476f3f5f38816a62b">opcua::Result::value</a></div><div class="ttdeci">constexpr T &amp; value() &amp;</div><div class="ttdoc">Get the value of the Result.</div><div class="ttdef"><b>Definition</b> <a href="result_8hpp_source.html#l00162">result.hpp:162</a></div></div>
<div class="ttc" id="aclassopcua_1_1Result_html_af8c52372741a4af137d3600d9e9e77e0"><div class="ttname"><a href="classopcua_1_1Result.html#af8c52372741a4af137d3600d9e9e77e0">opcua::Result::code</a></div><div class="ttdeci">constexpr StatusCode code() const noexcept</div><div class="ttdoc">Get the StatusCode of the Result.</div><div class="ttdef"><b>Definition</b> <a href="result_8hpp_source.html#l00140">result.hpp:140</a></div></div>
<div class="ttc" id="aclassopcua_1_1StatusCode_html_a800dd598a93c04af80b96d312c6700e9"><div class="ttname"><a href="classopcua_1_1StatusCode.html#a800dd598a93c04af80b96d312c6700e9">opcua::StatusCode::isBad</a></div><div class="ttdeci">constexpr bool isBad() const noexcept</div><div class="ttdoc">Check if the status code is bad.</div><div class="ttdef"><b>Definition</b> <a href="types_8hpp_source.html#l00076">types.hpp:76</a></div></div>
<div class="ttc" id="aclassopcua_1_1StatusCode_html_aa8edfc4253bc97d93129d7b123ab468f"><div class="ttname"><a href="classopcua_1_1StatusCode.html#aa8edfc4253bc97d93129d7b123ab468f">opcua::StatusCode::name</a></div><div class="ttdeci">std::string_view name() const noexcept</div><div class="ttdoc">Get human-readable name of the StatusCode.</div><div class="ttdef"><b>Definition</b> <a href="types_8hpp_source.html#l00061">types.hpp:61</a></div></div>
<div class="ttc" id="aclassopcua_1_1StatusCode_html_ace5935f872494fe518def45b1105f312"><div class="ttname"><a href="classopcua_1_1StatusCode.html#ace5935f872494fe518def45b1105f312">opcua::StatusCode::get</a></div><div class="ttdeci">constexpr UA_StatusCode get() const noexcept</div><div class="ttdoc">Explicitly get underlying UA_StatusCode.</div><div class="ttdef"><b>Definition</b> <a href="types_8hpp_source.html#l00053">types.hpp:53</a></div></div>
<div class="ttc" id="aclassopcua_1_1Variant_html"><div class="ttname"><a href="classopcua_1_1Variant.html">opcua::Variant</a></div><div class="ttdoc">UA_Variant wrapper class.</div><div class="ttdef"><b>Definition</b> <a href="types_8hpp_source.html#l00887">types.hpp:887</a></div></div>
<div class="ttc" id="agroup__Read_html_gaaf1c6945f6ca882fdafa7d3be783f68c"><div class="ttname"><a href="group__Read.html#gaaf1c6945f6ca882fdafa7d3be783f68c">opcua::services::readValue</a></div><div class="ttdeci">Result&lt; Variant &gt; readValue(T &amp;connection, const NodeId &amp;id) noexcept</div><div class="ttdoc">Read the AttributeId::Value attribute of a node.</div><div class="ttdef"><b>Definition</b> <a href="attribute__highlevel_8hpp_source.html#l00648">attribute_highlevel.hpp:648</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md21"></a>
Error propagation is user callbacks</h1>
<p>Since callbacks are executed within the open62541 C event loop, which does not support exceptions, any exceptions thrown inside user-defined callbacks are automatically caught and stored by <a class="el" href="classopcua_1_1detail_1_1ExceptionCatcher.html" title="Catch &amp; store exceptions from user-defined callbacks in an exception-unaware context (open62541).">opcua::detail::ExceptionCatcher</a>. These exceptions are then propagated to the <a class="el" href="classopcua_1_1Client.html#a8b1a8e65b22a27b245dd478170e4922d" title="Run the client&#39;s main loop by. This method will block until Client::stop is called.">opcua::Client::run()</a> and <a class="el" href="classopcua_1_1Server.html#a7346a714c85e2d99fc8bc9fd1dd31d6d" title="Run the server&#39;s main loop. This method will block until Server::stop is called.">opcua::Server::run()</a> functions, ensuring they can be handled properly.</p>
<p><b>Example:</b></p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classopcua_1_1Client.html">opcua::Client</a> client;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// define callback that throws an exception</span></div>
<div class="line">client.<a class="code hl_function" href="classopcua_1_1Client.html#a84ce29636803d55d617f09f70a82ae48">onSessionActivated</a>([] { <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;User exception!&quot;</span>); });</div>
<div class="line"> </div>
<div class="line">client.<a class="code hl_function" href="classopcua_1_1Client.html#a6dbd84c74a6214369470379a355555ab">connect</a>(<span class="stringliteral">&quot;opc.tcp://localhost:4840&quot;</span>);</div>
<div class="line"><span class="keywordflow">try</span> {</div>
<div class="line">    client.<a class="code hl_function" href="classopcua_1_1Client.html#a8b1a8e65b22a27b245dd478170e4922d">run</a>();  <span class="comment">// exceptions in callbacks are propagated to the run call</span></div>
<div class="line">} <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; e) {</div>
<div class="line">    std::cerr &lt;&lt; e.what() &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="ttc" id="aclassopcua_1_1Client_html"><div class="ttname"><a href="classopcua_1_1Client.html">opcua::Client</a></div><div class="ttdoc">High-level client class.</div><div class="ttdef"><b>Definition</b> <a href="client_8hpp_source.html#l00063">client.hpp:63</a></div></div>
<div class="ttc" id="aclassopcua_1_1Client_html_a6dbd84c74a6214369470379a355555ab"><div class="ttname"><a href="classopcua_1_1Client.html#a6dbd84c74a6214369470379a355555ab">opcua::Client::connect</a></div><div class="ttdeci">void connect(std::string_view endpointUrl)</div><div class="ttdoc">Connect to the selected server.</div></div>
<div class="ttc" id="aclassopcua_1_1Client_html_a84ce29636803d55d617f09f70a82ae48"><div class="ttname"><a href="classopcua_1_1Client.html#a84ce29636803d55d617f09f70a82ae48">opcua::Client::onSessionActivated</a></div><div class="ttdeci">void onSessionActivated(StateCallback callback)</div><div class="ttdoc">Set a state callback that will be called after the session is activated.</div></div>
<div class="ttc" id="aclassopcua_1_1Client_html_a8b1a8e65b22a27b245dd478170e4922d"><div class="ttname"><a href="classopcua_1_1Client.html#a8b1a8e65b22a27b245dd478170e4922d">opcua::Client::run</a></div><div class="ttdeci">void run()</div><div class="ttdoc">Run the client's main loop by. This method will block until Client::stop is called.</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
